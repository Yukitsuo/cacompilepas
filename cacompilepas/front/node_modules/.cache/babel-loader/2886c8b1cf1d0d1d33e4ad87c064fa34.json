{"ast":null,"code":"var _jsxFileName = \"/usr/src/app/client/src/View/Connection/Connection.tsx\";\nimport React from 'react';\nimport Request from '../../API/Request';\nimport '../../css/Connection.css';\nimport Input from \"../General/Input\";\nimport SubmitButton from \"../General/SubmitButton\";\nimport Header from \"../General/Header\";\n\nclass Connection extends React.Component {\n  constructor(props) {\n    super(props);\n    this.email = void 0;\n    this.password = void 0;\n    this.email = '';\n    this.password = '';\n    this.state = {\n      status: '',\n      token: '',\n      tokenExists: false,\n      formWasSubmitted: false\n    };\n    this.referrerIsNotConnection = this.referrerIsNotConnection.bind(this);\n    this.handleEmailChange = this.handleEmailChange.bind(this);\n    this.handlePasswordChange = this.handlePasswordChange.bind(this);\n    this.submit = this.submit.bind(this);\n    this.updateConnectStatus = this.updateConnectStatus.bind(this);\n    this.setState = this.setState.bind(this);\n    this.checkIfAlreadyConnected = this.checkIfAlreadyConnected.bind(this);\n  } // Check if token is still valid\n\n\n  componentDidMount() {\n    if (undefined !== localStorage.getItem('token') && '' !== localStorage.getItem('token')) {\n      new Request('/connection/verification', this.checkIfAlreadyConnected);\n    }\n  }\n\n  checkIfAlreadyConnected(data) {\n    this.setState({\n      tokenExists: data['token_exists']\n    });\n\n    if (false === this.state.tokenExists) {\n      localStorage.setItem('token', '');\n    }\n  } // Check if referrer is not '/connexion/login' in order to prevent a redirecting infinite loop\n\n\n  referrerIsNotConnection() {\n    // @ts-ignore\n    return document.referrer.split(/\\//)[3] !== 'connexion' && document.referrer.split(/\\//)[4] !== 'login';\n  }\n\n  handleEmailChange(event) {\n    // @ts-ignore\n    this.email = event.target.value;\n  }\n\n  handlePasswordChange(event) {\n    // @ts-ignore\n    this.password = event.target.value;\n  }\n\n  updateConnectStatus(data) {\n    this.setState({\n      status: '' + data['connected']\n    });\n    localStorage.setItem('token', data['token']);\n  }\n\n  submit(event) {\n    event.preventDefault();\n    new Request('/connection/login', this.updateConnectStatus, 'POST', {\n      email: this.email,\n      password: this.password\n    });\n    this.setState({\n      formWasSubmitted: true\n    });\n  }\n\n  render() {\n    return React.createElement(\"section\", {\n      className: 'content row connection-bloc',\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 93\n      },\n      __self: this\n    }, React.createElement(\"div\", {\n      className: 'container-fluid',\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 94\n      },\n      __self: this\n    }, React.createElement(Header, {\n      h1: 'Connecte-toi ici',\n      p: 'Comme ça tu pourras accéder à notre merveilleux site de partage de fiches de cours !',\n      containerClassName: 'ml-0 ml-lg-4 ml-md-4 ml-sm-4 mb-5',\n      contentClassName: 'pl-0 pl-lg-3 pl-md-3 pl-sm-3',\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 95\n      },\n      __self: this\n    }), React.createElement(\"div\", {\n      className: 'row',\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 101\n      },\n      __self: this\n    }, (() => {\n      // If token exists and user connected, redirect to referrer\n      // Else if form was submitted and credentials were incorrect,\n      // display an error message\n      if (undefined !== localStorage.getItem('token') || '' !== localStorage.getItem('token')) {\n        if ('true' === this.state.status || true === this.state.tokenExists) {\n          if (this.referrerIsNotConnection()) {\n            // @ts-ignore\n            window.location = this.props.referrer;\n          } else {\n            // @ts-ignore\n            window.location = '/';\n          }\n        } else if ('false' === this.state.status && true === this.state.formWasSubmitted) {\n          return React.createElement(\"div\", {\n            className: 'col-lg-3 col-sm-11 mt-0 mb-lg-4 mb-md-4 mb-sm-4 mb-xs-4 rounded-1 container-fluid p-0',\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 117\n            },\n            __self: this\n          }, React.createElement(\"div\", {\n            className: 'container-fluid col-12 p-0',\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 120\n            },\n            __self: this\n          }, React.createElement(\"div\", {\n            className: 'col-12 connection-error',\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 121\n            },\n            __self: this\n          }, \"Identifiants incorrects\")));\n        }\n      }\n    })()), React.createElement(\"div\", {\n      className: 'row',\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 131\n      },\n      __self: this\n    }, React.createElement(\"form\", {\n      id: 'connectForm',\n      className: 'col-lg-6 col-md-4 col-sm-4 col-lg-offset-3 col-sm-3 container-fluid',\n      onSubmit: this.submit,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 132\n      },\n      __self: this\n    }, React.createElement(\"div\", {\n      className: 'row pl-4',\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 137\n      },\n      __self: this\n    }, React.createElement(\"div\", {\n      className: 'row container-fluid',\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 138\n      },\n      __self: this\n    }, React.createElement(\"div\", {\n      className: 'col-12 p-0',\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 139\n      },\n      __self: this\n    }, React.createElement(Input, {\n      id: 'input-mail',\n      inputType: 'email',\n      placeholder: 'Adresse email',\n      checked: false,\n      className: '',\n      onChange: this.handleEmailChange,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 140\n      },\n      __self: this\n    }))), React.createElement(\"div\", {\n      className: 'row container-fluid',\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 150\n      },\n      __self: this\n    }, React.createElement(\"div\", {\n      className: 'col-12 mt-4 p-0',\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 151\n      },\n      __self: this\n    }, React.createElement(Input, {\n      id: 'input-password',\n      inputType: 'password',\n      placeholder: 'Mot de passe',\n      checked: false,\n      className: '',\n      onChange: this.handlePasswordChange,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 152\n      },\n      __self: this\n    })))), React.createElement(SubmitButton, {\n      text: 'Connexion',\n      onClick: this.submit,\n      className: 'mt-4',\n      disconnectButton: false,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 163\n      },\n      __self: this\n    })))));\n  }\n\n}\n\nexport default Connection;","map":{"version":3,"sources":["/usr/src/app/client/src/View/Connection/Connection.tsx"],"names":["React","Request","Input","SubmitButton","Header","Connection","Component","constructor","props","email","password","state","status","token","tokenExists","formWasSubmitted","referrerIsNotConnection","bind","handleEmailChange","handlePasswordChange","submit","updateConnectStatus","setState","checkIfAlreadyConnected","componentDidMount","undefined","localStorage","getItem","data","setItem","document","referrer","split","event","target","value","preventDefault","render","window","location"],"mappings":"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","sourcesContent":["import React, {ChangeEvent, FormEvent, ReactElement, ReactNode} from 'react';\nimport Request from '../../API/Request';\nimport '../../css/Connection.css';\nimport Input from \"../General/Input\";\nimport SubmitButton from \"../General/SubmitButton\";\nimport Header from \"../General/Header\";\n\ninterface ConnectionStates {\n    // Pending (''), connected ('true') or not connected ('false')\n    status: string,\n    token: string,\n    tokenExists: boolean,\n    formWasSubmitted: boolean,\n}\n\nclass Connection extends React.Component<{ referrer: string }, ConnectionStates> {\n    private email: string;\n    private password: string;\n\n    constructor(props: any) {\n        super(props);\n        this.email = '';\n        this.password = '';\n        this.state = {\n            status: '',\n            token: '',\n            tokenExists: false,\n            formWasSubmitted: false,\n        }\n        this.referrerIsNotConnection = this.referrerIsNotConnection.bind(this);\n        this.handleEmailChange = this.handleEmailChange.bind(this);\n        this.handlePasswordChange = this.handlePasswordChange.bind(this);\n        this.submit = this.submit.bind(this);\n        this.updateConnectStatus = this.updateConnectStatus.bind(this);\n        this.setState = this.setState.bind(this);\n        this.checkIfAlreadyConnected = this.checkIfAlreadyConnected.bind(this);\n    }\n\n    // Check if token is still valid\n    public componentDidMount(): void {\n        if (undefined !== localStorage.getItem('token') && '' !== localStorage.getItem('token')) {\n            new Request(\n                '/connection/verification',\n                this.checkIfAlreadyConnected,\n            );\n        }\n    }\n\n    public checkIfAlreadyConnected(data: any): void {\n        this.setState({tokenExists: data['token_exists']});\n        if (false === this.state.tokenExists) {\n            localStorage.setItem('token', '');\n        }\n    }\n\n    // Check if referrer is not '/connexion/login' in order to prevent a redirecting infinite loop\n    public referrerIsNotConnection(): boolean {\n        // @ts-ignore\n        return document.referrer.split(/\\//)[3] !== 'connexion' && document.referrer.split(/\\//)[4] !== 'login';\n    }\n\n    public handleEmailChange(event: ChangeEvent<HTMLInputElement>): void {\n        // @ts-ignore\n        this.email = event.target.value;\n    }\n\n    public handlePasswordChange(event: ChangeEvent<HTMLInputElement>): void {\n        // @ts-ignore\n        this.password = event.target.value;\n    }\n\n    public updateConnectStatus(data: any): void {\n        this.setState({status: '' + data['connected']});\n        localStorage.setItem('token', data['token']);\n    }\n\n    public submit(event: React.MouseEvent<HTMLButtonElement, MouseEvent> | FormEvent<HTMLFormElement>): void {\n        event.preventDefault();\n        new Request(\n            '/connection/login',\n            this.updateConnectStatus,\n            'POST',\n            {\n                email: this.email,\n                password: this.password\n            },\n        );\n        this.setState({formWasSubmitted: true});\n    }\n\n    render(): ReactNode {\n        return (\n            <section className={'content row connection-bloc'}>\n                <div className={'container-fluid'}>\n                    <Header\n                        h1={'Connecte-toi ici'}\n                        p={'Comme ça tu pourras accéder à notre merveilleux site de partage de fiches de cours !'}\n                        containerClassName={'ml-0 ml-lg-4 ml-md-4 ml-sm-4 mb-5'}\n                        contentClassName={'pl-0 pl-lg-3 pl-md-3 pl-sm-3'}\n                    />\n                    <div className={'row'}>\n                        {(() => {\n                            // If token exists and user connected, redirect to referrer\n                            // Else if form was submitted and credentials were incorrect,\n                            // display an error message\n                            if (undefined !== localStorage.getItem('token') || '' !== localStorage.getItem('token')) {\n                                if ('true' === this.state.status || true === this.state.tokenExists) {\n                                    if (this.referrerIsNotConnection()) {\n                                        // @ts-ignore\n                                        window.location = this.props.referrer;\n                                    } else {\n                                        // @ts-ignore\n                                        window.location = '/';\n                                    }\n                                } else if ('false' === this.state.status && true === this.state.formWasSubmitted) {\n                                    return (\n                                        <div\n                                            className={'col-lg-3 col-sm-11 mt-0 mb-lg-4 mb-md-4 mb-sm-4 mb-xs-4 rounded-1 container-fluid p-0'}\n                                        >\n                                            <div className={'container-fluid col-12 p-0'}>\n                                                <div className={'col-12 connection-error'}>\n                                                    Identifiants incorrects\n                                                </div>\n                                            </div>\n                                        </div>\n                                    );\n                                }\n                            }\n                        })()}\n                    </div>\n                    <div className={'row'}>\n                        <form\n                            id={'connectForm'}\n                            className={'col-lg-6 col-md-4 col-sm-4 col-lg-offset-3 col-sm-3 container-fluid'}\n                            onSubmit={this.submit}\n                        >\n                            <div className={'row pl-4'}>\n                                <div className={'row container-fluid'}>\n                                    <div className={'col-12 p-0'}>\n                                        <Input\n                                            id={'input-mail'}\n                                            inputType={'email'}\n                                            placeholder={'Adresse email'}\n                                            checked={false}\n                                            className={''}\n                                            onChange={this.handleEmailChange}\n                                        />\n                                    </div>\n                                </div>\n                                <div className={'row container-fluid'}>\n                                    <div className={'col-12 mt-4 p-0'}>\n                                        <Input\n                                            id={'input-password'}\n                                            inputType={'password'}\n                                            placeholder={'Mot de passe'}\n                                            checked={false}\n                                            className={''}\n                                            onChange={this.handlePasswordChange}\n                                        />\n                                    </div>\n                                </div>\n                            </div>\n                            <SubmitButton\n                                text={'Connexion'}\n                                onClick={this.submit}\n                                className={'mt-4'}\n                                disconnectButton={false}\n                            />\n                        </form>\n                    </div>\n                </div>\n            </section>\n        )\n    }\n}\n\nexport default Connection;\n"]},"metadata":{},"sourceType":"module"}