{"ast":null,"code":"var _jsxFileName = \"/usr/src/app/client/src/View/Lobby/CourseSheet.tsx\";\nimport React from 'react';\nimport Request from '../../API/Request';\nimport '../../css/CourseSheet.css';\nimport exampleImage from '../../img/example.png';\nimport minusIcon from '../../img/minus-icon-red-t.png';\nimport Hashtag from '../General/Hashtag';\nimport { pdfjs } from 'react-pdf';\n\nclass CourseSheet extends React.Component {\n  constructor(props) {\n    super(props);\n    this.state = {\n      currentHashtagIndex: -1,\n      hashtags: [],\n      file: null,\n      previewSrc: ''\n    };\n    this.updateWidth = this.updateWidth.bind(this);\n    this.remove = this.remove.bind(this);\n    this.getFile = this.getFile.bind(this);\n    this.openFile = this.openFile.bind(this);\n    this.fillHashtags = this.fillHashtags.bind(this);\n    this.fetchHashtags = this.fetchHashtags.bind(this);\n    this.refreshPreview = this.refreshPreview.bind(this);\n    this.updateFilePreview = this.updateFilePreview.bind(this);\n    this.fillPreview = this.fillPreview.bind(this);\n  }\n\n  componentDidMount() {\n    this.refreshPreview();\n    this.fetchHashtags();\n  }\n\n  refreshPreview() {\n    new Request('/lobby/coursesheet/' + this.props.idLobby, this.fillPreview, 'POST', {\n      path: this.props.link\n    }, 'json', 'blob');\n  }\n\n  fillPreview(data) {\n    console.log('hello');\n    this.setState({\n      file: data\n    }, this.updateFilePreview);\n  }\n\n  updateFilePreview() {\n    let reader = new FileReader();\n\n    if (null !== this.state.file) {\n      if (this.state.file.type === 'application/pdf') {\n        pdfjs.GlobalWorkerOptions.workerSrc = `//cdnjs.cloudflare.com/ajax/libs/pdf.js/${pdfjs.version}/pdf.worker.js`;\n      } else {\n        reader.addEventListener('load', () => {\n          // @ts-ignore\n          this.setState({\n            src: reader.result\n          });\n        });\n\n        if (this.state.file) {\n          reader.readAsDataURL(this.state.file);\n        }\n      }\n    }\n  }\n\n  fillHashtags(data) {\n    this.setState({\n      hashtags: data.map(hashtag => hashtag[0])\n    }, () => this.forceUpdate(() => this.render()));\n  }\n\n  fetchHashtags() {\n    new Request('/coursesheet/getHashtags/' + this.props.id, this.fillHashtags);\n  }\n\n  updateWidth() {}\n\n  remove(event) {\n    let content;\n    let target = event.target;\n\n    if (undefined === target.parentElement.firstElementChild.innerText) {\n      content = target.parentElement.parentElement.parentElement.firstElementChild.innerText;\n\n      if ('' === content) {\n        content = target.parentElement.parentElement.parentElement.parentElement.firstElementChild.firstElementChild.innerText;\n\n        if ('' === content) {\n          content = target.parentElement.parentElement.firstElementChild.innerText;\n        }\n      }\n    } else {\n      content = target.parentElement.firstElementChild.innerText;\n    }\n\n    content = content.substr(1, content.length - 1);\n    this.setState({\n      currentHashtagIndex: this.state.hashtags.indexOf(content)\n    }, () => {\n      if (-1 !== this.state.currentHashtagIndex) {\n        new Request('/coursesheet/removeHashtag/' + this.props.id, this.fetchHashtags, 'POST', {\n          hashtag: content\n        });\n      }\n    });\n  }\n\n  openFile(data) {\n    const link = document.createElement('a');\n    const blob = new Blob([data], {\n      type: 'application/pdf'\n    });\n    link.href = URL.createObjectURL(blob); // @ts-ignore\n\n    window.open(document.location);\n    window.open(link.href, '_blank');\n    window.close();\n  }\n\n  getFile(event) {\n    event.preventDefault();\n    new Request('/lobby/coursesheet/' + this.props.idLobby, this.openFile, 'POST', {\n      path: this.props.link\n    }, 'json', 'blob');\n  }\n\n  renderHashtags() {\n    let res = [];\n\n    for (let hashtag of this.state.hashtags) {\n      res.push(React.createElement(Hashtag, {\n        key: hashtag,\n        text: hashtag,\n        updateWidth: this.updateWidth,\n        isRemovable: this.props.removableHashtags,\n        remove: this.remove,\n        className: '',\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 164\n        },\n        __self: this\n      }));\n    }\n\n    return React.createElement(\"div\", {\n      style: {\n        display: 'flex',\n        flexFlow: 'row wrap',\n        alignItems: 'center'\n      },\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 175\n      },\n      __self: this\n    }, res);\n  }\n\n  render() {\n    return React.createElement(\"div\", {\n      id: 'coursesheet-' + this.props.id,\n      className: 'row mt-5 col-lg-12 col-md-12 col-sm-12 col-xs-12',\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 184\n      },\n      __self: this\n    }, React.createElement(\"div\", {\n      className: 'col-lg-2 col-md-2 col-sm-2 col-xs-2 mt-lg-4 mt-md-4 mt-sm-4 mt-xs-4 pl-lg-0 pl-md-0 pl-sm-0 pl-xs-0 pr-lg-0 pr-md-0 pr-sm-0 pr-xs-0',\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 185\n      },\n      __self: this\n    }, React.createElement(\"img\", {\n      className: 'course-sheet-image rounded',\n      src: exampleImage,\n      alt: 'Course sheet',\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 187\n      },\n      __self: this\n    }), React.createElement(\"img\", {\n      src: this.state.previewSrc,\n      alt: 'Course sheet preview',\n      style: {\n        width: '100px',\n        borderRadius: '10px'\n      },\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 188\n      },\n      __self: this\n    })), React.createElement(\"div\", {\n      className: 'col-lg-10 col-md-10 col-sm-10 col-xs-10 pr-sm-0 pr-0',\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 197\n      },\n      __self: this\n    }, React.createElement(\"div\", {\n      className: 'container-fluid row pl-0',\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 198\n      },\n      __self: this\n    }, React.createElement(\"h3\", {\n      className: 'col-lg-11 col-md-11 col-sm-11 col-xs-11 text-left mt-lg-0 mt-md-0 mt-sm-0 mt-xs-0',\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 199\n      },\n      __self: this\n    }, this.props.title), this.props.activeRemoveButton ? React.createElement(\"div\", {\n      className: 'col-lg-1 col-md-1 col-sm-1 col-xs-1',\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 201\n      },\n      __self: this\n    }, React.createElement(\"img\", {\n      id: 'coursesheet-remove-' + this.props.id,\n      src: minusIcon,\n      alt: 'Minus Icon',\n      className: 'remove-button plus-icon ml-5 mr-0',\n      onClick: this.props.delete,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 202\n      },\n      __self: this\n    })) : React.createElement(\"div\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 210\n      },\n      __self: this\n    })), React.createElement(\"div\", {\n      className: 'col-lg-12 col-md-12 col-sm-12 col-xs-12 mb-2 text-left pl-1 float-none',\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 212\n      },\n      __self: this\n    }, this.renderHashtags()), React.createElement(\"div\", {\n      className: 'course-sheet-presentation ml-lg-1 ml-md-1 ml-sm-1 ml-xs-1',\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 215\n      },\n      __self: this\n    }, React.createElement(\"p\", {\n      className: 'course-sheet-description',\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 216\n      },\n      __self: this\n    }, this.props.description), React.createElement(\"footer\", {\n      className: 'pl-lg-0',\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 217\n      },\n      __self: this\n    }, React.createElement(\"a\", {\n      href: '' + document.location,\n      className: 'course-sheet-link col-lg-6 col-md-6 col-sm-6 col-xs-6 text-lg-left text-md-left text-sm-left text-xs-left pl-lg-0 pl-md-0 pl-sm-0 pl-xs-0 d-block mt-lg-2 mt-md-2 mt-sm-2 mt-xs-2',\n      onClick: this.getFile,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 218\n      },\n      __self: this\n    }, \"Lien vers la fiche\"), React.createElement(\"h4\", {\n      className: 'col-lg-6 col-md-6 col-sm-6 col-xs-6 text-lg-right text-md-right text-sm-right text-xs-right',\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 223\n      },\n      __self: this\n    }, \"Mathys\")))));\n  }\n\n}\n\nexport default CourseSheet;","map":{"version":3,"sources":["/usr/src/app/client/src/View/Lobby/CourseSheet.tsx"],"names":["React","Request","exampleImage","minusIcon","Hashtag","pdfjs","CourseSheet","Component","constructor","props","state","currentHashtagIndex","hashtags","file","previewSrc","updateWidth","bind","remove","getFile","openFile","fillHashtags","fetchHashtags","refreshPreview","updateFilePreview","fillPreview","componentDidMount","idLobby","path","link","data","console","log","setState","reader","FileReader","type","GlobalWorkerOptions","workerSrc","version","addEventListener","src","result","readAsDataURL","map","hashtag","forceUpdate","render","id","event","content","target","undefined","parentElement","firstElementChild","innerText","substr","length","indexOf","document","createElement","blob","Blob","href","URL","createObjectURL","window","open","location","close","preventDefault","renderHashtags","res","push","removableHashtags","display","flexFlow","alignItems","width","borderRadius","title","activeRemoveButton","delete","description"],"mappings":"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","sourcesContent":["import React, {ReactNode} from 'react';\nimport Request from '../../API/Request';\nimport '../../css/CourseSheet.css';\nimport exampleImage from '../../img/example.png';\nimport minusIcon from '../../img/minus-icon-red-t.png';\nimport Hashtag from '../General/Hashtag';\nimport {pdfjs, Document, Page} from 'react-pdf';\n\ninterface CourseSheetProps {\n    id: string,\n    idLobby: string,\n    title: string,\n    publication_date: string,\n    link: string,\n    description: string,\n    activeRemoveButton: boolean,\n    removableHashtags: boolean,\n    delete: ((event: React.MouseEvent<HTMLImageElement, MouseEvent>) => void) | undefined,\n}\n\ninterface CourseSheetState {\n    currentHashtagIndex: number,\n    hashtags: string[],\n    file: File | null,\n    previewSrc: string,\n}\n\nclass CourseSheet extends React.Component<CourseSheetProps, CourseSheetState> {\n    public constructor(props: CourseSheetProps) {\n        super(props);\n        this.state = {\n            currentHashtagIndex: -1,\n            hashtags: [],\n            file: null,\n            previewSrc: '',\n        }\n        this.updateWidth = this.updateWidth.bind(this);\n        this.remove = this.remove.bind(this);\n        this.getFile = this.getFile.bind(this);\n        this.openFile = this.openFile.bind(this);\n        this.fillHashtags = this.fillHashtags.bind(this);\n        this.fetchHashtags = this.fetchHashtags.bind(this);\n        this.refreshPreview = this.refreshPreview.bind(this);\n        this.updateFilePreview = this.updateFilePreview.bind(this);\n        this.fillPreview = this.fillPreview.bind(this);\n    }\n\n    public componentDidMount(): void {\n        this.refreshPreview();\n        this.fetchHashtags();\n    }\n\n    public refreshPreview(): void {\n        new Request(\n            '/lobby/coursesheet/' + this.props.idLobby,\n            this.fillPreview,\n            'POST',\n            {path: this.props.link},\n            'json',\n            'blob',\n        );\n    }\n\n    public fillPreview(data: any): void {\n        console.log('hello');\n        this.setState(\n            {file: data},\n            this.updateFilePreview);\n    }\n\n    public updateFilePreview(): void {\n        let reader = new FileReader();\n        if (null !== this.state.file) {\n            if (this.state.file.type === 'application/pdf') {\n                pdfjs.GlobalWorkerOptions.workerSrc = `//cdnjs.cloudflare.com/ajax/libs/pdf.js/${pdfjs.version}/pdf.worker.js`;\n            } else {\n                reader.addEventListener('load', () => {\n                    // @ts-ignore\n                    this.setState({src: reader.result});\n                });\n\n                if (this.state.file) {\n                    reader.readAsDataURL(this.state.file);\n                }\n            }\n        }\n    }\n\n    public fillHashtags(data: any): void {\n        this.setState(\n            {hashtags: data.map((hashtag: any) => hashtag[0])},\n            () => this.forceUpdate(() => this.render()));\n    }\n\n    public fetchHashtags(): void {\n        new Request(\n            '/coursesheet/getHashtags/' + this.props.id,\n            this.fillHashtags,\n        )\n    }\n\n    public updateWidth(): void {\n\n    }\n\n    public remove(event: React.MouseEvent<HTMLOrSVGElement>): void {\n        let content: string;\n        let target: any = event.target;\n        if (undefined === target.parentElement.firstElementChild.innerText) {\n            content = target.parentElement.parentElement.parentElement.firstElementChild.innerText;\n            if ('' === content) {\n                content = target.parentElement.parentElement.parentElement.parentElement.firstElementChild.firstElementChild.innerText;\n                if ('' === content) {\n                    content = target.parentElement.parentElement.firstElementChild.innerText;\n                }\n            }\n        } else {\n            content = target.parentElement.firstElementChild.innerText;\n        }\n        content = content.substr(1, content.length - 1);\n        this.setState(\n            {currentHashtagIndex: this.state.hashtags.indexOf(content)},\n            () => {\n                if (-1 !== this.state.currentHashtagIndex) {\n                    new Request(\n                        '/coursesheet/removeHashtag/' + this.props.id,\n                        this.fetchHashtags,\n                        'POST',\n                        {hashtag: content},\n                    )\n                }\n            });\n    }\n\n    public openFile(data: Blob): void {\n        const link = document.createElement('a');\n        const blob = new Blob([data], {type: 'application/pdf'});\n        link.href = URL.createObjectURL(blob);\n        // @ts-ignore\n        window.open(document.location);\n        window.open(link.href, '_blank');\n        window.close();\n    }\n\n    public getFile(event: React.MouseEvent<HTMLAnchorElement, MouseEvent>): void {\n        event.preventDefault();\n        new Request(\n            '/lobby/coursesheet/' + this.props.idLobby,\n            this.openFile,\n            'POST',\n            {\n                path: this.props.link\n            },\n            'json',\n            'blob',\n        );\n    }\n\n    public renderHashtags(): ReactNode {\n        let res: ReactNode[] = [];\n\n        for (let hashtag of this.state.hashtags) {\n            res.push(\n                <Hashtag\n                    key={hashtag}\n                    text={hashtag}\n                    updateWidth={this.updateWidth}\n                    isRemovable={this.props.removableHashtags}\n                    remove={this.remove}\n                    className={''}\n                />\n            )\n        }\n\n        return <div style={{\n            display: 'flex',\n            flexFlow: 'row wrap',\n            alignItems: 'center',\n        }}>{res}</div>;\n    }\n\n    public render(): ReactNode {\n        return (\n            <div id={'coursesheet-' + this.props.id} className={'row mt-5 col-lg-12 col-md-12 col-sm-12 col-xs-12'}>\n                <div\n                    className={'col-lg-2 col-md-2 col-sm-2 col-xs-2 mt-lg-4 mt-md-4 mt-sm-4 mt-xs-4 pl-lg-0 pl-md-0 pl-sm-0 pl-xs-0 pr-lg-0 pr-md-0 pr-sm-0 pr-xs-0'}>\n                    <img className={'course-sheet-image rounded'} src={exampleImage} alt={'Course sheet'}/>\n                    <img\n                        src={this.state.previewSrc}\n                        alt={'Course sheet preview'}\n                        style={{\n                            width: '100px',\n                            borderRadius: '10px',\n                        }}\n                        />\n                </div>\n                <div className={'col-lg-10 col-md-10 col-sm-10 col-xs-10 pr-sm-0 pr-0'}>\n                    <div className={'container-fluid row pl-0'}>\n                        <h3 className={'col-lg-11 col-md-11 col-sm-11 col-xs-11 text-left mt-lg-0 mt-md-0 mt-sm-0 mt-xs-0'}>{this.props.title}</h3>\n                        {this.props.activeRemoveButton ?\n                            <div className={'col-lg-1 col-md-1 col-sm-1 col-xs-1'}>\n                                <img\n                                    id={'coursesheet-remove-' + this.props.id}\n                                    src={minusIcon}\n                                    alt={'Minus Icon'}\n                                    className={'remove-button plus-icon ml-5 mr-0'}\n                                    onClick={this.props.delete}\n                                />\n                            </div> :\n                            <div></div>}\n                    </div>\n                    <div className={'col-lg-12 col-md-12 col-sm-12 col-xs-12 mb-2 text-left pl-1 float-none'}>\n                        {this.renderHashtags()}\n                    </div>\n                    <div className={'course-sheet-presentation ml-lg-1 ml-md-1 ml-sm-1 ml-xs-1'}>\n                        <p className={'course-sheet-description'}>{this.props.description}</p>\n                        <footer className={'pl-lg-0'}>\n                            <a\n                                href={'' + document.location}\n                                className={'course-sheet-link col-lg-6 col-md-6 col-sm-6 col-xs-6 text-lg-left text-md-left text-sm-left text-xs-left pl-lg-0 pl-md-0 pl-sm-0 pl-xs-0 d-block mt-lg-2 mt-md-2 mt-sm-2 mt-xs-2'}\n                                onClick={this.getFile}\n                            >Lien vers la fiche</a>\n                            <h4 className={'col-lg-6 col-md-6 col-sm-6 col-xs-6 text-lg-right text-md-right text-sm-right text-xs-right'}>Mathys</h4>\n                        </footer>\n                    </div>\n                </div>\n            </div>\n        )\n    }\n}\n\nexport default CourseSheet;\n"]},"metadata":{},"sourceType":"module"}